---
 - name: Install docker-app
   hosts: staging_app
   remote_user: svc_ansible
   become: yes

   tasks:
     - name: Install dependencies
       apt:
          name: "{{item}}"
          state: present
       loop:
          - ca-certificates
          - curl
     - name: Add GPG key
       apt_key:
         url: https://download.docker.com/linux/ubuntu/gpg
         state: present
     - name: Install Docker
       apt:
        name: "{{item}}"
        state: present
       loop:
          - docker-ce
          - docker-ce-cli
          - containerd.io
          - docker-buildx-plugin
          - docker-compose-plugin
     - name: Check if docker service is running
       service:
          name: docker
          state: started
          enabled: yes
       register: docker_service
     - name: Print the status of docker service
       debug:
         var: docker_service.status
     - name: Add svc_ansible user to docker group
       user:
         name: svc_ansible
         groups: docker
         append: yes

